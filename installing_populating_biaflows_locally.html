<!DOCTYPE html>
<html lang="en">
<head>
    <title>Creating a BIA workflow and adding it to a BIAFLOWS instance</title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="favicon.ico">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
          rel='stylesheet' type='text/css'>
    <!-- FontAwesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js"
            integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH"
            crossorigin="anonymous"></script>
    <!-- Global CSS -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">
    <!-- Plugins CSS -->
    <link rel="stylesheet" href="assets/plugins/prism/prism.css">
    <link rel="stylesheet" href="assets/plugins/elegant_font/css/style.css">
    <!-- Theme CSS -->
    <link id="theme-style" rel="stylesheet" href="assets/css/styles.css">
</head>

<body class="body-pink">
<div class="page-wrapper">
    <!-- ******Header****** -->
    <header id="header" class="header">
        <div class="container">
            <div class="branding">
                <h1 class="logo">
                    <a href="index.html">
                        <span aria-hidden="true" class="icon_documents_alt icon"></span>
                        <span class="text-highlight">BIA</span><span class="text-bold">FLOWS</span>
                    </a>
                </h1>

            </div>
        </div><!--//container-->
    </header><!--//header-->
    <div class="doc-wrapper">
        <div class="container">
            <div id="doc-header" class="doc-header text-center">
                <h1 class="doc-title">Installing and populating BIAFLOWS locally</h1>
                <div class="meta"><i class="far fa-clock"></i> Last updated: March 18st, 2020</div>
            </div>
            <!--//doc-header-->
            <div class="doc-body row">
                <div class="doc-content col-md-9 col-12 order-1">
                    <div class="content-inner">
                        <section id="introduction-section" class="doc-section">
                            <h2 class="section-title">Introduction</h2>
                            <p class="section-block">
                                It is possible to install <span style="color:#fe7f7f;">BIA</span>FLOWS on a local server or a
                                desktop computer. This might be useful to manage and analyse images locally.
                                The procedure is described below and should take less than 30 minutes
                                (UNIX based system recommended).
                            </p>
                        </section><!--//doc-section-->
                        <section id="installing-section" class="doc-section">
                            <h2 class="section-title">Installing a local instance of BIAFLOWS</h2>
                            <p class="section-block">
                                The procedure described in this section is for Linux Ubuntu
                                but it should be possible to install BIAFLOWS on other platforms
                                (not tested). Some specific details related to deployment on Mac
                                OS can be found <a href="https://doc.uliege.cytomine.org/display/PubOp/Install+Cytomine+on+MacOS">online</a>.
                            </p>
                            <div id="installing_step1" class="section-block">
                                <h4>1. Install requirement</h4>
                                <p>
                                    BIAFLOWS runs in Docker containers, the only requirement is to install Docker.
                                    Check <a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/#install-using-the-repository">official Docker documentation</a>
                                    to install Docker for Ubuntu. Choose <em>Install using the repository</em>, set up the
                                    repository and install Docker CE.
                                </p>
                            </div>
                            <div id="installing_step2" class="section-block">
                                <h4>2. Retrieve BIAFLOWS installation files</h4>
<pre class="language-bash"><code class="language-bash">
mkdir Biaflows
cd Biaflows
git clone https://github.com/Neubias-WG5/Biaflows-bootstrap.git
cd Biaflows-bootstrap
</code></pre>
                            </div>
                            <div id="installing_step3" class="section-block">
                                <h4>3. Configure the local instance</h4>
                                <p>
                                    Edit configuration.sh and, if needed, update URLs
                                    (CORE_URL, IMS_URL, UPLOAD_URL).
                                    Make sure to use URLs that are not already used by other applications
                                    (avoid localhost) to prevent conflicts. In <em>/etc/hosts</em> of the host machine,
                                    add the following lines, adapting them accordingly to chosen XXX_URL in configuration.sh.
                                </p>
<pre class="language-bash"><code class="language-bash">
127.0.0.1 biaflows
127.0.0.1 biaflows-ims
127.0.0.1 biaflows-upload
127.0.0.1 rabbitmq
</code></pre>
                                <p>
                                    If needed, update data path variables (IMS_STORAGE_PATH â€¦).
                                    All data paths must be valid and mappable in the Docker engine.
                                    If they don't exist, create all the directories (<code>mkdir</code>) corresponding to
                                    the following variables:
                                </p>
<pre class="language-bash"><code class="language-bash">
IMS_STORAGE_PATH
IMS_BUFFER_PATH
FAST_DATA_PATH
PROXY_CACHE_PATH
SOFTWARE_CODE_PATH
SOFTWARE_DOCKER_IMAGES_PATH
JOBS_PATH
SERVER_SSHKEYS_PATH
</code></pre>
                                <p>
                                    A reference to these URLs and paths is provided here:
                                    <a href="https://doc.uliege.cytomine.org/display/PubOp/Cytomine+configuration+reference" target="_blank">https://doc.uliege.cytomine.org/display/PubOp/Cytomine+configuration+reference</a>
                                </p>
                                <p>
                                    Configure <code>BIAFLOWS_WORKFLOWS_METRICS</code> to <em>true</em> or <em>false</em>
                                    depending if you want to perform benchmarking. If set to <em>true</em>,
                                    <b>ground truth annotations are then  required for all images</b>.
                                    Setting this flag to false is the valid option if you plan to manage and
                                    process local images.
                                </p>
                            </div>
                            <div id="installing_step4" class="section-block">
                                <h4>4. Initialize the deployment</h4>
                                <p>
                                    Run the installation script: <code>sudo bash init.sh</code>
                                </p>
                            </div>
                            <div id="installing_step5" class="section-block">
                                <h4>5. Deploy the local instance</h4>
                                <p>
                                    Run the generated deployment script: <code>sudo bash start.sh</code>
                                </p>
                            </div>
                            <div id="installing_step6" class="section-block">
                                <h4>6. Check the running instance</h4>
                                <p>
                                    When start up is finished, check that the application is running in your browser
                                    at the URL specified by CORE_URL (default: http://biaflows).
                                </p>
                                <p>
                                    Three accounts with different access rights are automatically created:
                                    <ul>
                                        <li>username: admin / password: admin</li>
                                        <li>username: guest / password: guest</li>
                                        <li>username: neubias / password: neubias</li>
                                    </ul>
                                    Passwords should be updated from the Account page (top right).
                                </p>
                            </div>
                            <div id="installing_step7" class="section-block">
                                <h4>7. Install sample projects (images and ground-truth data)</h4>
                                <p>
                                    After BIAFLOWS successfully installed locally, the local instance is empty.
                                    All projects available in BIAFLOWS online instance can be imported to the local
                                    instance. For this, get the public and private keys of the admin account
                                    (Account page), then run:
                                </p>
<pre class="language-bash"><code class="language-bash">
cd Biaflows-bootstrap
sudo bash ./inject_demo_data.sh ADMIN_PUBLIC_KEY ADMIN_PRIVATE_KEY
</code></pre>
                                <p>where <code>ADMIN_PUBLIC_KEY</code> and <code>ADMIN_PRIVATE_KEY</code>
                                    have been substituted by their respective values.
                                </p>
                                <p>
                                    The script starts to download projects and import them in your local BIAFLOWS.
                                    The list of imported projects can be tweaked by editing the file
                                    <code>Biaflows-bootstrap/configs/project_migrator/projects.txt</code>.
                                </p>
                                <p>
                                    The whole data injection procedure can take several minutes, depending on your
                                    Internet connection and the number of projects being imported.
                                </p>
                            </div>
                        </section>


                        <section id="newproblem-section" class="doc-section">
                            <h2 class="section-title">Creating a new problem (project) in a local BIAFLOWS instance</h2>
                            <div id="newproblem_step1" class="section-block">
                            <h4>1. Create a new problem</h4>
                            <p>
                                To create a new problem, connect as regular user or admin, go to the <em>Connect</em>
                                tab
                                <div class="screenshot-holder">
                                    <img class="img-fluid" src="assets/images/doc_biaflow_locally_01.png" alt="screenshot">
                                </div>
                                and click on <img class="img-fluid" src="assets/images/doc_biaflow_locally_02.png" alt="screenshot">
                            </p>
                            </div>
                            <div id="newproblem_step2" class="section-block">
                                <h4>2. Choose a meaningful problem name and save</h4>
                                <div class="screenshot-holder">
                                    <img class="img-fluid" src="assets/images/doc_biaflow_locally_03.png" alt="screenshot">
                                </div>
                            </div>
                            <div id="newproblem_step3" class="section-block">
                                <h4>3. Problem configuration</h4>
                                <p>The problem is ready to be configured, the following configuration is recommended:</p>
                                <div class="screenshot-holder">
                                    <img class="img-fluid" src="assets/images/doc_biaflow_locally_04.png" alt="screenshot">
                                </div>
                            </div>
                            <div id="newproblem_step4" class="section-block">
                                <h4>4. Assign the problem to a problem class</h4>
                                <p>
                                    Assign your problem to a problem class
                                    (see <a href="problem_class_ground_truth.html">Problem Class, Ground truth annotations and reported metrics</a>)
                                    by clicking on <em>Change problem class</em>. The problem class specifies the format of ground
                                    truth annotations (and workflow outputs), as well as the associated benchmark
                                    metrics to be computed (if benchmark is enabled).
                                </p>
                                <div class="screenshot-holder">
                                    <img class="img-fluid" src="assets/images/doc_biaflow_locally_05.png" alt="screenshot">
                                </div>
                            </div>
                            <div id="newproblem_step5" class="section-block">
                                <h4>5. Configure project members</h4>
                                <p>
                                    If you work alone, you can leave contributors and project managers to default user.
                                    This can be done from the <em>Members</em> tab in the problem configuration.
                                </p>
                            </div>
                            <div id="newproblem_step6" class="section-block">
                                <h4>6. Custom the User Interface</h4>
                                <p>
                                    The problem can be fully configured to display or hide panels / tabs / tools in the
                                    user interface. This is achieved from the Custom UI tab in the problem configuration.
                                </p>
                            </div>
                            <div id="newproblem_step7" class="section-block">
                                <h4>7. Add a description to the problem</h4>
                                <p>
                                    A description of the problem can optionally be added from the <em>Information</em>
                                    (left sidebar). The description is displayed in <em>Problems list</em>.
                                </p>
                            </div>
                        </section>


                        <section id="uploading_gt-section" class="doc-section">
                            <h2 class="section-title">Uploading ground truth annotations to an existing BIAFLOWS problem</h2>
                            <p class="section-block">
                                If you plan to perform benchmarking, ground truth annotations should also be uploaded and
                                associated to every image of a problem. The format of these annotations depends on the
                                associated problem class (see
                                <a href="problem_class_ground_truth.html">Problem Class, ground truth annotations and reported metrics</a>).
                            </p>
                            <p>
                                Image annotations (e.g. binary masks) should be uploaded as 16-bit TIFF (or
                                <a href="https://docs.openmicroscopy.org/ome-model/latest/ome-tiff/" target="_blank">OME-TIFF</a>)
                                for 2D images and as single file 16-bit
                                <a href="https://docs.openmicroscopy.org/ome-model/latest/ome-tiff/" target="_blank">OME-TIFF</a>
                                for multidimensional (C,Z,T) images. They should be uploaded by following the procedure
                                described in the previous section and by setting the same name as their corresponding
                                image + <code>_lbl</code> suffix (e.g. <em>myImage.ome.tif and myImage<b>_lbl</b>.ome.tif</em>).
                            </p>
                            <p>
                                Other required annotations (e.g. SWC, division text file) should be added to the
                                images as attached files. To do so, expand the image (blue arrow) in the list
                                and click on <em>Add</em> next to <em>Attached files</em>.
                            </p>
                            <div class="screenshot-holder">
                                <img class="img-fluid" src="assets/images/doc_biaflow_locally_08.png" alt="screenshot">
                            </div>
                        </section>

                        <section id="adding_workflow-section" class="doc-section">
                            <h2 class="section-title">Adding existing workflows from trusted sources to a local BIAFLOWS instance</h2>
                            <p class="section-block">
                                It is possible to integrate existing BIAFLOWS workflows to any BIAFLOWS instance.
                                This operation requires configuring an external trusted source made of:
                                <ol>
                                    <li>A source code registry (typically a Github user space)</li>
                                    <li>An execution environment registry (typically a DockerHub user space)</li>
                                </ol>
                            </p>
                            <p class="section-block">
                                If your workflow repositories are mixed with other repositories in your user space,
                                you can specify a prefix to distinguish workflows repositories. For instance,
                                all bioimage analysis workflows developed by NEUBIAS are prefixed by <code>W_</code> and
                                available from this user space: <a href="https://github.com/Neubias-WG5">https://github.com/Neubias-WG5</a>.
                            </p>
                            <div class="callout-block callout-info">
                                <div class="icon-holder">
                                    <svg class="svg-inline--fa fa-info-circle fa-w-16" aria-hidden="true"
                                         focusable="false" data-prefix="fas" data-icon="info-circle" role="img"
                                         xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
                                        <path fill="currentColor"
                                              d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"></path>
                                    </svg><!-- <i class="fas fa-info-circle"></i> -->
                                </div><!--//icon-holder-->
                                <div class="content">
                                    <p>
                                        Some information regarding trusted sources is given below.
                                    </p>
                                    <p>To manage trusted sources, you need to be administrator.</p>
                                </div><!--//content-->
                            </div>
                            <div id="adding_workflow_step1" class="section-block">
                                <h4>1. Connect as administrator</h4>
                                <p>
                                    Connect as administrator by clicking <em>Open admin session</em>.
                                </p>
                                <div class="screenshot-holder">
                                    <img class="img-fluid" src="assets/images/doc_biaflow_locally_09.png" alt="screenshot">
                                </div>
                            </div>
                            <div id="adding_workflow_step2" class="section-block">
                                <h4>2. Add trusted source</h4>
                                <p>
                                    In administration page, go to <em>Trusted sources</em> tab and click <em>New trusted source</em>.
                                </p>
                                <div class="screenshot-holder">
                                    <img class="img-fluid" src="assets/images/doc_biaflow_locally_09_02.png" alt="screenshot">
                                </div>
                            </div>
                            <div id="adding_workflow_step3" class="section-block">
                                <h4>3. Save the trusted source</h4>
                                <p>
                                    Fill the form and Save
                                </p>
                                <div class="screenshot-holder">
                                    <img class="img-fluid" src="assets/images/doc_biaflow_locally_10.png" alt="screenshot">
                                </div>
                                <p>
                                    For instance, to add NEUBIAS curated set of workflows, the trusted source has to be configured as follows:
                                </p>
                                <ul>
                                    <li>Source code provider: <em>github</em></li>
                                    <li>Source code provider username: <em>Neubias-WG5</em></li>
                                    <li>Environment provider: <em>docker</em></li>
                                    <li>Environment provider username: <em>neubiaswg5</em></li>
                                    <li>Prefix: <em>W_</em></li>
                                </ul>
                            </div>

                            <div id="adding_workflow_step4" class="section-block">
                                <h4>4. Manually import the new workflows</h4>
                                <p>
                                    Trusted sources are periodically checked (about every 5/10 minutes) to automatically
                                    add new versions of existing workflows or new workflows, but you can also click
                                    on <em>Refresh</em> to trigger the check.
                                </p>
                                <div class="screenshot-holder">
                                    <img class="img-fluid" src="assets/images/doc_biaflow_locally_11.png" alt="screenshot">
                                </div>
                            </div>

                            <div id="adding_workflow_step5" class="section-block">
                                <h4>5. Link imported workflows</h4>
                                <p>
                                    Once a workflow is imported, it has to be linked to a BIAFLOWS <em>Problem</em>.
                                    This can be performed in the Configuration panel of the <em>Problem</em>
                                    (<em>Workflows</em> tab) by toggling <em>Enable</em> for that workflow as illustrated below:
                                </p>
                                <div class="screenshot-holder">
                                    <img class="img-fluid" src="assets/images/doc_biaflow_locally_12.png" alt="screenshot">
                                </div>
                            </div>



                        </section>


                    </div><!--//content-inner-->
                </div><!--//doc-content-->
                <div class="doc-sidebar col-md-3 col-12 order-0 d-none d-md-flex">
                    <div id="doc-nav" class="doc-nav">
                        <nav id="doc-menu" class="nav doc-menu flex-column sticky">
                            <a class="nav-link scrollto" href="#introduction-section">Introduction</a>
                            <a class="nav-link scrollto" href="#installing-section">Installing a local instance of BIAFLOWS</a>
                            <nav class="doc-sub-menu nav flex-column">
                                <a class="nav-link scrollto" href="#installing_step1">1. Install requirement</a>
                                <a class="nav-link scrollto" href="#installing_step2">2. Retrieve BIAFLOWS installation files</a>
                                <a class="nav-link scrollto" href="#installing_step3">3. Configure the local instance</a>
                                <a class="nav-link scrollto" href="#installing_step4">4. Initialize the deployment</a>
                                <a class="nav-link scrollto" href="#installing_step5">5. Deploy the local instance</a>
                                <a class="nav-link scrollto" href="#installing_step6">6. Check the running instance</a>
                                <a class="nav-link scrollto" href="#installing_step7">7. Install sample projects</a>
                            </nav><!--//nav-->
                            <a class="nav-link scrollto" href="#newproblem-section">Creating a new problem (project) in a local BIAFLOWS instance</a>
                            <nav class="doc-sub-menu nav flex-column">
                                <a class="nav-link scrollto" href="#newproblem_step1">1. Create a new problem</a>
                                <a class="nav-link scrollto" href="#newproblem_step2">2. Choose a meaningful problem name</a>
                                <a class="nav-link scrollto" href="#newproblem_step3">3. Problem configuration</a>
                                <a class="nav-link scrollto" href="#newproblem_step4">4. Assign the problem to a problem class</a>
                                <a class="nav-link scrollto" href="#newproblem_step5">5. Configure project members</a>
                                <a class="nav-link scrollto" href="#newproblem_step6">6. Custom the User Interface</a>
                                <a class="nav-link scrollto" href="#newproblem_step7">7. Add a description to the problem</a>
                            </nav><!--//nav-->
                            <a class="nav-link scrollto" href="#uploading_gt-section">Uploading ground truth annotations</a>
                            <a class="nav-link scrollto" href="#adding_workflow-section">Adding existing workflows from trusted source</a>
                            <nav class="doc-sub-menu nav flex-column">
                                <a class="nav-link scrollto" href="#adding_workflow_step1">1. Connect as administrator</a>
                                <a class="nav-link scrollto" href="#adding_workflow_step2">2. Add trusted source</a>
                                <a class="nav-link scrollto" href="#adding_workflow_step3">3. Save the trusted source</a>
                                <a class="nav-link scrollto" href="#adding_workflow_step4">4. Manually import the new workflows</a>
                                <a class="nav-link scrollto" href="#adding_workflow_step5">5. Link imported workflows</a>
                            </nav><!--//nav-->
                        </nav><!--//doc-menu-->
                    </div>
                </div><!--//doc-sidebar-->
            </div><!--//doc-body-->
        </div><!--//container-->
    </div><!--//doc-wrapper-->
</div><!--//page-wrapper-->
<footer id="footer" class="footer text-center">
    <div class="container">
        <!--/* This template is released under the Creative Commons Attribution 3.0 License. Please keep the attribution link below when using for your own project. Thank you for your support. :) If you'd like to use the template without the attribution, you can buy the commercial license via our website: themes.3rdwavemedia.com */-->
        <small class="copyright">Designed with <i class="fas fa-heart"></i> by <a
                href="https://themes.3rdwavemedia.com/" target="_blank">Xiaoying Riley</a> for developers</small>
        <p>
            <br><br>
            <a href="http://neubias.org/" target="_blank"><img src="assets/images/logo-neubias.png" height="50"></a>
            <a href="https://cost.eu/COST_Actions/ca/CA15124" target="_blank"><img src="assets/images/logo-cost.png"
                                                                                   height="50"></a>
            <a href="https://cytomine.org"><img src="assets/images/logo-cytomine-org.png" height="50"></a>
            <a href="http://europe.wallonie.be/" target="_blank"><img src="assets/images/logo-feder.jpg"
                                                                      height="50"></a>
        </p>
    </div><!--//container-->
</footer><!--//footer-->
<!-- Main Javascript -->
<script type="text/javascript" src="assets/plugins/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="assets/plugins/prism/prism.js"></script>
<script type="text/javascript" src="assets/plugins/jquery-scrollTo/jquery.scrollTo.min.js"></script>
<script type="text/javascript" src="assets/plugins/stickyfill/dist/stickyfill.min.js"></script>
<script type="text/javascript" src="assets/js/main.js"></script>
</body>
</html>
